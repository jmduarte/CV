%----------------------------------------------------------------------------------------
%	PACKAGES AND OTHER DOCUMENT CONFIGURATIONS
%----------------------------------------------------------------------------------------

\documentclass{res}


\usepackage{palatino}%    Choose default roman font.  Others are times, pslatex, newcent, bookman, chancery
\usepackage{mathpazo}%  Match
\usepackage{helvet}%      Choose default sans serif

\usepackage{simplemargins}
\usepackage{slashed}
\usepackage[dvipsnames]{xcolor}
\usepackage{doi}


\newcommand{\MarginText}[1]{\section{#1}\vspace{10pt}}

\usepackage{hyperref} % Required for adding links	and customizing them
\hypersetup{colorlinks=false, breaklinks, pdfborder = {0 0 0}}

\usepackage{ifthen}
\newboolean{cms@italic}
\setboolean{cms@italic}{false}
\newboolean{cms@external}
\setboolean{cms@external}{false}


\newcommand*\publistbasestyle{phys}
\usepackage[style=publist,
biblabel=brackets,
   sorting=dt,
   plauthorhandling=highlight,
   plnumbered=reset,
   nameorder=given-family
]{biblatex}
 \plauthorname[Javier]{Duarte}
\DeclareSourcemap{
 \maps[datatype=bibtex,overwrite=true]{
  \map{
    \step[fieldsource=Collaboration, final=true]
    \step[fieldset=usera, origfieldval, final=true]
  }
 }
}

\renewbibmacro*{author}{%
  \iffieldundef{usera}{%
    \printnames{author}%
  }{%
    \printfield{usera} Collaboration% \printnames{author}%
  }%
}%


\DeclareSourcemap{
    \maps[datatype=bibtex]{
      \map{
        \step[fieldsource=contributioncodes, final=true]
        \step[fieldset=userb, origfieldval, final=true]
    }
  }
}

% for UCSD, add contribution codes to recent pubs
\DeclareFieldFormat{bold}{\mkbibbold{#1}}
\renewbibmacro*{note}{%
\iffieldundef{userb}{%
\printfield{note}%
}{%
\ifkeyword{recent}{%
\iffieldundef{note}{%
  \printtext[bold]{Author Contribution Code(s):} \printfield{userb}%
}{%
  \printfield{note} \newunit \printtext[bold]{Author Contribution Code(s):} \printfield{userb}%
 }%
 }%
}%
{%
\printfield{note}%
}%
\newunit%
}

% for UCSD, mark recent with asterisk
\renewbibmacro*{begentry}{\ifkeyword{recent}{\makebox[0pt][r]{\textasteriskcentered\addspace}}{}}
\AtEveryBibitem{%
  \ifkeyword{career}%
    {\color{Maroon}}%
    {}%
  }

%%% --- The following two lines are what needs to be added --- %%%
\setcounter{biburllcpenalty}{7000}
\setcounter{biburlucpenalty}{8000}
% Name of your .bib file(s)
%\usepackage[utf8]{inputenc}
\addbibresource{bib_publications.bib}
\addbibresource{bib_refproceedings.bib}
\addbibresource{bib_proceedings.bib}
\addbibresource{bib_workinprogress.bib}
\addbibresource{bib_bookchapters.bib}
\addbibresource{bib_other.bib}

\newlength{\datebox}\settowidth{\datebox}{Spring 2011} % Set the width of the date box in each block

\newcommand{\NewEntry}[3]{\noindent\hangindent=2em\hangafter=0 \parbox{\datebox}{\small \textit{#1}}\hspace{1.5em} #2 #3 % Define a command for each new block - change spacing and font sizes here: #1 is the left margin, #2 is the italic date field and #3 is the position/employer/location field
\vspace{0.5em}} % Add some white space after each new entry

\newcommand{\Description[1]}{\noindent #1\vspace{-2pt}}

\usepackage[pazoGreek]{heppennames2}
\usepackage{ptdr-definitions}

\newsectionwidth{10pt} % Stops section indenting

\setallmargins{1in}

\begin{document}

%----------------------------------------------------------------------------------------
%	NAME AND CONTACT INFORMATION SECTION
%----------------------------------------------------------------------------------------

\address{}
\address{}

\newcommand{\DOI}[1]{\href{https://doi.org/#1}{doi:#1}}
\begin{resume}

  %----------------------------------------------------------------------------------------
  %	PUBLICATIONS
  %----------------------------------------------------------------------------------------
  %\clearpage
  %\setcounter{page}{5}

  As a member of the CMS Collaboration, I am an author of hundreds of peer-reviewed articles.
  Selected publications, reports, book chapters, and conference proceedings to which I made a substantial contribution are listed in {\color{Maroon}maroon}.

  \MarginText{A. PRIMARY PUBLISHED OR CREATIVE WORK}
  \subsection{I. Original Peer-Reviewed Work or Listing of Creative Endeavors}
  \subsubsection{a. Research Articles}
  \newrefsection[bib_publications]
  \nocite{*}
  \vspace{10pt}
  \printbibliography[heading=none]

  \subsection{III. Books and Book Chapters}
  \newrefsection[bib_bookchapters]
  \nocite{*}
  \vspace{10pt}
  \printbibliography[heading=none]

  \subsection{IV. Refereed Conference Proceedings}
  \newrefsection[bib_refproceedings]
  \nocite{*}
  \vspace{10pt}
  \printbibliography[heading=none]

  \MarginText{B. OTHER WORK}
  \subsection{I. Other Conference Proceedings}
  \newrefsection[bib_proceedings]
  \nocite{*}
  \vspace{10pt}
  \printbibliography[heading=none]

  \subsection{II. Abstracts}
  \subsection{III. Popular Works}
  \subsection{IV. Additional Products of Major Research}
  \newrefsection[bib_other]
  \nocite{*}
  \vspace{10pt}
  \printbibliography[heading=none]

  \MarginText{C. WORK IN PROGRESS}
  % \vspace{10pt}
  % \newrefsection[bib_workinprogress]
  % \nocite{*}
  % \vspace{10pt}
  % \printbibliography[heading=none]
  \clearpage

\end{resume}

\end{document}
